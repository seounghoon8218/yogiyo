<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #28. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<mapper namespace="yogiyo">
	
	<resultMap type="HashMap" id="categoryList">
		
		<result property="shopcategorycode" 	column="shopcategorycode" 		javaType="String" />
		<result property="shopcategoryname" 	column="shopcategoryname" 		javaType="String" />
		
	</resultMap>

	<select id="getShopCategory" resultMap="categoryList">
		select shopcategorycode, shopcategoryname 
		from tbl_shopcategory
	</select>
	
	<resultMap type="HashMap" id="chartTest">
		
		<result property="shopcategoryname" 	column="shopcategoryname" 	javaType="String" />
		<result property="cnt" 				column="cnt" 				javaType="String" />
		<result property="percnt" 			column="percnt" 			javaType="String" />
		
	</resultMap>
	
	<!-- // 차트 테스트 ( 업종별 매장수 차트 ) -->
	<select id="chartList" resultMap="chartTest">
		select C.shopcategoryname as shopcategoryname
		      , count(*) as cnt
              , round(count(*)/(select count(*) from TBL_SHOP)*100,2) as percnt
		from TBL_SHOPCATEGORY C left join TBL_SHOP S
		on S.shopcategorycode = C.shopcategorycode
		group by C.shopcategoryname
		order by percnt desc
	</select>
	
	<insert id="insertPayment" parameterType="HashMap" >
		insert into tbl_payment(payno,addr1,addr2,tel,yocheong,totalprice,paymethod,email,paymenuname,masterno)
		values(seq_tbl_payment_payno.nextval,#{addr1},#{addr2},#{tel},#{yocheong},#{totalprice},'card',#{email},#{paymenuname},#{masterno} )
	</insert>
	
	<!-- // 결제완료했으면 해당 아이디 장바구니 비우기 -->
	<delete id="alldeleteCart" parameterType="String">
		delete from TBL_CART where email = #{email}
	</delete>
	
</mapper>


